<div class="md:w-300 w-300 mt-4 mb-2 p-4 bg-gray-800 rounded-lg shadow mx-auto">
  <div class="flex items-center mb-4 justify-between">
    <div class="flex flex-col sm:flex-row mt-4 mb-2 ">
      <%= link_to "<", channels_path, class: "text-center sm:mt-0 sm:ml-2 rounded-md px-3.5 py-3.5 bg-gray-800 hover:underline inline-block font-medium text-gray-100" %>
      <h1 class="font-bold text-4xl inline-block text-gray-100 mr-8">#<%= @channel.name %></h1>
      <%= link_to "Edit channel", edit_channel_path(@channel), class: "text-center rounded-md px-1.5 py-1.5 bg-gray-800 hover:underline inline-block font-medium text-gray-100" %>
    </div>
    <div id="channel-members" class="mt-4 mb-2 p-4 bg-gray-800 rounded-lg shadow inline-block">
      <h2 class="font-bold text-lg text-gray-100 ml-4 inline-block">Members:</h2>
        <%#= turbo_stream_from @channel, "users" %>
        <%= render @channel.users %>
    </div>
  </div>

  <div class="w-full h-155 bg-gray-800 shadow rounded-lg px-5 my-4 mt-4">
    <div id="chat" class="h-155 space-y-4 my-4 overflow-y-auto">
      <div id="messages">
        <%= turbo_stream_from @channel, "messages" %>
        <%= render @channel.messages %>
      </div>
    </div>

    <script>
      new MutationObserver(() => chat.scrollTop = chat.scrollHeight)
        .observe(chat, {childList: true, subtree: true});
      chat.scrollTop = chat.scrollHeight;
    </script>
</div>

  <%= form_with model: [@channel, Message.new], class: "mt-4", data: { controller: "reset-form", action: "turbo:submit-end->reset-form#reset" } do |f| %>
    <div class="flex gap-4 items-center px-2 py-3 bg-gray-800 rounded-lg">
      <%= f.text_field :content,
          class: "flex-1 min-h-[80px] rounded-lg border-gray-600 bg-gray-700 text-gray-100 shadow-sm focus:border-indigo-400 focus:ring-indigo-400 px-3 py-2 resize-none focus:outline-none suggestions-none",
          placeholder: "Type your message..."
        %>

      <%= f.submit "Send",
        class: "rounded-lg py-3 px-5 bg-blue-700 text-white inline-block font-medium cursor-pointer hover:bg-blue-600"
      %>
    </div>
  <% end %>

<%# field reset after sending a message %>
  <script>
    document.addEventListener('turbo:submit-end', function(e) {
      if (e.detail.success) e.target.reset();
    });
  </script>
</div>